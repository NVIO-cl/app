extends includes/doctype
append head-content
    title Detalle - NVIO
    script(async='', src='https://www.googletagmanager.com/gtag/js?id=G-SJETCMY2EN')
    script.
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-SJETCMY2EN', {
        'user_id': '#{userID}'
      });
    link(rel='stylesheet' href='https://nvio.s3.amazonaws.com/assets/bootstrap/css/bootstrap.min.css')
    link(rel='stylesheet' href='https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i')
    link(rel='stylesheet' href='https://use.fontawesome.com/releases/v5.12.0/css/all.css')
    link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css')
    link(rel='stylesheet' href='https://nvio.s3.amazonaws.com/assets/fonts/fontawesome5-overrides.min.css')
append body-content
    #wrapper
        include includes/sidebar
        #content-wrapper.d-flex.flex-column
            #content
                nav.navbar.navbar-light.navbar-expand.bg-white.shadow.mb-4.topbar.static-top
                    //--
                        .container-fluid
                            button#sidebarToggleTop.btn.btn-link.d-md-none.rounded-circle.mr-3(type='button')
                                i.fas.fa-bars
                            form.form-inline.d-none.d-sm-inline-block.mr-auto.ml-md-3.my-2.my-md-0.mw-100.navbar-search
                                .input-group
                                    input.bg-light.form-control.border-0.small(type='text' placeholder='Buscar...')
                                    .input-group-append
                                        button.btn.btn-primary.py-0(type='button' style='background: #6e3c8e;')
                                            i.fas.fa-search
                            ul.nav.navbar-nav.flex-nowrap.ml-auto
                                li.nav-item.dropdown.d-sm-none.no-arrow
                                    a.dropdown-toggle.nav-link(data-toggle='dropdown' aria-expanded='false' href='#')
                                        i.fas.fa-search
                                    .dropdown-menu.dropdown-menu-right.p-3.animated--grow-in(aria-labelledby='searchDropdown')
                                        form.form-inline.mr-auto.navbar-search.w-100
                                            .input-group
                                                input.bg-light.form-control.border-0.small(type='text' placeholder='Search for ...')
                                                .input-group-append
                                                    button.btn.btn-primary.py-0(type='button')
                                                        i.fas.fa-search
                                li.nav-item.dropdown.no-arrow.mx-1
                                    .nav-item.dropdown.no-arrow
                                        a.dropdown-toggle.nav-link(data-toggle='dropdown' aria-expanded='false' href='#')
                                            span.badge.badge-danger.badge-counter 3+
                                            i.fas.fa-bell.fa-fw
                                        .dropdown-menu.dropdown-menu-right.dropdown-list.dropdown-menu-right.animated--grow-in
                                            h6.dropdown-header alerts center
                                            a.d-flex.align-items-center.dropdown-item(href='#')
                                                .mr-3
                                                    .bg-primary.icon-circle
                                                        i.fas.fa-file-alt.text-white
                                                div
                                                    span.small.text-gray-500 December 12, 2019
                                                    p A new monthly report is ready to download!
                                            a.d-flex.align-items-center.dropdown-item(href='#')
                                                .mr-3
                                                    .bg-success.icon-circle
                                                        i.fas.fa-donate.text-white
                                                div
                                                    span.small.text-gray-500 December 7, 2019
                                                    p $290.29 has been deposited into your account!
                                            a.d-flex.align-items-center.dropdown-item(href='#')
                                                .mr-3
                                                    .bg-warning.icon-circle
                                                        i.fas.fa-exclamation-triangle.text-white
                                                div
                                                    span.small.text-gray-500 December 2, 2019
                                                    p Spending Alert: We&apos;ve noticed unusually high spending for your account.
                                            a.text-center.dropdown-item.small.text-gray-500(href='#') Show All Alerts
                                li.nav-item.dropdown.no-arrow.mx-1
                                    .nav-item.dropdown.no-arrow
                                        a.dropdown-toggle.nav-link(data-toggle='dropdown' aria-expanded='false' href='#')
                                            i.fas.fa-envelope.fa-fw
                                            span.badge.badge-danger.badge-counter 7
                                        .dropdown-menu.dropdown-menu-right.dropdown-list.dropdown-menu-right.animated--grow-in
                                            h6.dropdown-header alerts center
                                            a.d-flex.align-items-center.dropdown-item(href='#')
                                                .dropdown-list-image.mr-3
                                                    img.rounded-circle(src='https://nvio.s3.amazonaws.com/assets/img/avatars/avatar4.jpeg')
                                                    .bg-success.status-indicator
                                                .font-weight-bold
                                                    .text-truncate
                                                        span Hi there! I am wondering if you can help me with a problem I&apos;ve been having.
                                                    p.small.text-gray-500.mb-0 Emily Fowler - 58m
                                            a.d-flex.align-items-center.dropdown-item(href='#')
                                                .dropdown-list-image.mr-3
                                                    img.rounded-circle(src='https://nvio.s3.amazonaws.com/assets/img/avatars/avatar2.jpeg')
                                                    .status-indicator
                                                .font-weight-bold
                                                    .text-truncate
                                                        span I have the photos that you ordered last month!
                                                    p.small.text-gray-500.mb-0 Jae Chun - 1d
                                            a.d-flex.align-items-center.dropdown-item(href='#')
                                                .dropdown-list-image.mr-3
                                                    img.rounded-circle(src='https://nvio.s3.amazonaws.com/assets/img/avatars/avatar3.jpeg')
                                                    .bg-warning.status-indicator
                                                .font-weight-bold
                                                    .text-truncate
                                                        span
                                                            | Last month&apos;s report looks great, I am very happy with the progress so far, keep up the good work!
                                                    p.small.text-gray-500.mb-0 Morgan Alvarez - 2d
                                            a.d-flex.align-items-center.dropdown-item(href='#')
                                                .dropdown-list-image.mr-3
                                                    img.rounded-circle(src='https://nvio.s3.amazonaws.com/assets/img/avatars/avatar5.jpeg')
                                                    .bg-success.status-indicator
                                                .font-weight-bold
                                                    .text-truncate
                                                        span
                                                            | Am I a good boy? The reason I ask is because someone told me that people say this to all dogs, even if they aren&apos;t good...
                                                    p.small.text-gray-500.mb-0 Chicken the Dog &middot; 2w
                                            a.text-center.dropdown-item.small.text-gray-500(href='#') Show All Alerts
                                    .shadow.dropdown-list.dropdown-menu.dropdown-menu-right(aria-labelledby='alertsDropdown')
                                .d-none.d-sm-block.topbar-divider
                                li.nav-item.dropdown.no-arrow
                                    .nav-item.dropdown.no-arrow
                                        a.dropdown-toggle.nav-link(data-toggle='dropdown' aria-expanded='false' href='#')
                                            span.d-none.d-lg-inline.mr-2.text-gray-600.small Juan P&eacute;rez
                                            img.border.rounded-circle.img-profile(src='https://nvio.s3.amazonaws.com/assets/img/dogs/image3.jpeg')
                                        .dropdown-menu.shadow.dropdown-menu-right.animated--grow-in
                                            a.dropdown-item(href='#')
                                                i.fas.fa-user.fa-sm.fa-fw.mr-2.text-gray-400
                                                | &nbsp;Profile
                                            a.dropdown-item(href='#')
                                                i.fas.fa-cogs.fa-sm.fa-fw.mr-2.text-gray-400
                                                | &nbsp;Settings
                                            a.dropdown-item(href='#')
                                                i.fas.fa-list.fa-sm.fa-fw.mr-2.text-gray-400
                                                | &nbsp;Activity log
                                            .dropdown-divider
                                            a.dropdown-item(href='#')
                                                i.fas.fa-sign-out-alt.fa-sm.fa-fw.mr-2.text-gray-400
                                                | &nbsp;Logout
                .container-fluid
                    a.btn.btn-primary(type='button' style='margin-bottom: 10px;background: #6e3c8e;' href='../historial')
                        i.fa.fa-arrow-left
                        | &nbsp;Regresar
                    .row
                        .col
                            .card.shadow.mb-4
                                .card-header.d-flex.justify-content-between.align-items-center
                                    // Pyme+orden
                                    h6#orderid.text-primary.font-weight-bold.m-0 Orden ##{order[0].SK.S.replace("ORDER#","")}
                                    .dropdown.no-arrow
                                        button.btn.btn-link.btn-sm.dropdown-toggle(data-toggle='dropdown' aria-expanded='false' type='button')
                                            i.fas.fa-ellipsis-v.text-gray-400
                                        .dropdown-menu.shadow.dropdown-menu-right.animated--fade-in
                                            p.text-center.dropdown-header dropdown header:
                                            a.dropdown-item(href='#') &nbsp;Action
                                            a.dropdown-item(href='#') &nbsp;Another action
                                            .dropdown-divider
                                            a.dropdown-item(href='#') &nbsp;Something else here
                                .card-body
                                    p(style='width: 100%;')
                                        | Link del cliente:&nbsp
                                        a(class='button' target="_blank" href='//app.nvio.cl/order/' + companyId + order[0].SK.S.replace("ORDER#","")) #{'app.nvio.cl/order/' + companyId + order[0].SK.S.replace("ORDER#","")}
                                        br
                                        | Fecha de Creación #{parsed_created_at}
                                        br
                                        | Estado: #{order[0].status.M.order.N}
                                        br
                                        | Método Entrega: #{order[0].shippingMethod.S}
                                        br
                                    strong Listado de Artículos
                                    .table-responsive(style='text-align: center;')
                                        table.table
                                            thead
                                                tr
                                                    th Nombre Producto
                                                    th Precio Unitario
                                                    th Cantidad
                                                    th Subtotal
                                            tbody
                                            each ORD, index in order[0].items.L
                                                tr
                                                    td #{ORD.M.product.S}
                                                    td #{ORD.M.price.N}
                                                    td #{ORD.M.quantity.N}
                                                    td
                                                        - var subtotal = parseInt(ORD.M.price.N) * parseInt(ORD.M.quantity.N)
                                                            | #{subtotal}

                                    .row
                                        .col
                                            strong Total Productos
                                        .col.col-3(style='text-align: center;')
                                            p $ #{order[0].cost.M.order.N}
                                    .row
                                        .col
                                            strong Total Despacho
                                        .col.col-3(style='text-align: center;')
                                            p $ #{order[0].cost.M.shipping.N}
                                    hr
                                    .row
                                        .col
                                            strong Total
                                        .col.col-3
                                            p(style='text-align: center;') $
                                                - var subtotal = parseInt(order[0].cost.M.order.N) + parseInt(order[0].cost.M.shipping.N)
                                                    | #{subtotal}
                            .card.shadow.mb-4
                                .card-header.d-flex.justify-content-between.align-items-center
                                    h6.text-primary.font-weight-bold.m-0 Estado de Pago
                                    .dropdown.no-arrow
                                        button.btn.btn-link.btn-sm.dropdown-toggle(data-toggle='dropdown' aria-expanded='false' type='button')
                                            i.fas.fa-ellipsis-v.text-gray-400
                                        .dropdown-menu.shadow.dropdown-menu-right.animated--fade-in
                                            p.text-center.dropdown-header dropdown header:
                                            a.dropdown-item(href='#') &nbsp;Action
                                            a.dropdown-item(href='#') &nbsp;Another action
                                            .dropdown-divider
                                            a.dropdown-item(href='#') &nbsp;Something else here
                                .card-body
                                    strong Comprobante de Pago
                                    p
                                    .text-center.small.mt-4
                                        img(src=logo style='margin-bottom: 5px; max-height: 250px;')
                                    button#comprobante.btn.btn-primary(type='button' style='background: #6e3c8e;') Descargar Comprobante
                        .col
                            .card.shadow.mb-4
                                .card-header.d-flex.justify-content-between.align-items-center
                                    h6.text-primary.font-weight-bold.m-0 Notas Del Cliente
                                    .dropdown.no-arrow
                                        button.btn.btn-link.btn-sm.dropdown-toggle(data-toggle='dropdown' aria-expanded='false' type='button')
                                            i.fas.fa-ellipsis-v.text-gray-400
                                        .dropdown-menu.shadow.dropdown-menu-right.animated--fade-in
                                            p.text-center.dropdown-header dropdown header:
                                            a.dropdown-item(href='#') &nbsp;Action
                                            a.dropdown-item(href='#') &nbsp;Another action
                                            .dropdown-divider
                                            a.dropdown-item(href='#') &nbsp;Something else here
                                .card-body
                                    -
                                        try {
                                            var nota = order[0].comment.S
                                        } catch (err) {
                                            var nota = "Aún no hay notas del cliente para esta orden"
                                        }
                                    p #{nota}

                            .card.shadow.mb-4
                                .card-header.d-flex.justify-content-between.align-items-center
                                    h6.text-primary.font-weight-bold.m-0 Detalles Cliente
                                    .dropdown.no-arrow
                                        button.btn.btn-link.btn-sm.dropdown-toggle(data-toggle='dropdown' aria-expanded='false' type='button')
                                            i.fas.fa-ellipsis-v.text-gray-400
                                        .dropdown-menu.shadow.dropdown-menu-right.animated--fade-in
                                            p.text-center.dropdown-header dropdown header:
                                            a.dropdown-item(href='#') &nbsp;Action
                                            a.dropdown-item(href='#') &nbsp;Another action
                                            .dropdown-divider
                                            a.dropdown-item(href='#') &nbsp;Something else here
                                .card-body
                                    -
                                        try {
                                            var cliente = order[0].clientData.M.firstName.S + " " + order[0].clientData.M.lastName.S
                                        } catch (err) {
                                            var cliente = "El cliente aún no ha registrado su nombre"
                                        }
                                    p
                                        strong #{cliente}
                                    hr
                                    .row
                                        .col
                                            p(style='width: 80%;') Información de Contacto
                                        .col.col-3(style='text-align: right;')
                                            a(href='#')
                                                i.fa.fa-pencil
                                    -
                                        try {
                                            var email = order[0].clientData.M.email.S
                                        } catch (err) {
                                            var email = "El cliente no ha registrado su email"
                                        }

                                    -
                                        try {
                                            var telefono = "+" + order[0].clientData.M.contactNumber.N
                                        } catch (err) {
                                            var telefono = "El cliente no ha registrado su teléfono"
                                        }

                                    p
                                        | #{email}
                                        br
                                        | #{telefono}
                                    hr
                                    .row
                                        .col
                                            p(style='width: 80%;') Direcci&oacute;n de Despacho
                                        .col.col-3(style='text-align: right;')
                                            a(href='#')
                                                i.fa.fa-pencil
                                    -
                                        try {
                                            var direccion = order[0].clientData.M.address.M.street.S + " " + order[0].clientData.M.address.M.apart.S
                                        } catch (err) {
                                            var direccion = "El cliente no ha registrado sus datos"
                                        }

                                    p
                                        | #{direccion}
                                        br
                                        | #{order[0].clientData.M.address.M.locality.S}
                                        br
                            .card.shadow.mb-4
                                .card-header.d-flex.justify-content-between.align-items-center
                                    h6.text-primary.font-weight-bold.m-0 Comentarios
                                    .dropdown.no-arrow
                                        button.btn.btn-link.btn-sm.dropdown-toggle(data-toggle='dropdown' aria-expanded='false' type='button')
                                            i.fas.fa-ellipsis-v.text-gray-400
                                        .dropdown-menu.shadow.dropdown-menu-right.animated--fade-in
                                            p.text-center.dropdown-header dropdown header:
                                            a.dropdown-item(href='#') &nbsp;Action
                                            a.dropdown-item(href='#') &nbsp;Another action
                                            .dropdown-divider
                                            a.dropdown-item(href='#') &nbsp;Something else here
                                .card-body
                                    .table-responsive(style='text-align: center;')
                                        table.table
                                            tbody
                                            each ORD, index in order[0].status.M.comments.L
                                                tr
                                                    td(class="text-break")
                                                        | #{ORD.M.comment.S}
                                                    td #{parsed_comments_date[index]}
                                    hr
                                    .input-group
                                        .input-group-prepend
                                        input#comentario.form-control(type='text')
                                        .input-group-append
                                            button#comentar.btn.btn-primary(type='button' style='background: #6e3c8e;') Comentar
            footer.bg-white.sticky-footer
                .container.my-auto
                    .text-center.my-auto.copyright
                        span Copyright &copy; NVIO 2020
        a.border.rounded.d-inline.scroll-to-top(href='#page-top')
            i.fas.fa-angle-up
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.bundle.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js')
    script(src='https://nvio.s3.amazonaws.com/assets/js/script.min.js')
    script(src='/javascripts/detail.js')
